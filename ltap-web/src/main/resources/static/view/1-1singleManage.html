<!doctype html>
<html lang="zh">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>选择题</title>
    <link href="css/all.css" rel="stylesheet" type="text/css">
    <link href="js/editor/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="js/editor/css/froala_editor.min.css" rel="stylesheet" type="text/css">
    <link href="css/alert.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
    <script src="js/jquery/jQuery-2.2.0.min.js"></script>
    <script src="js/editor/js/froala_editor.min.js"></script>
    <script src="js/alert.js"></script>
    <script src="js/editor/js/plugins/tables.min.js"></script>
    <script src="js/editor/js/plugins/lists.min.js"></script>
    <script src="js/editor/js/plugins/colors.min.js"></script>
    <script src="js/editor/js/plugins/media_manager.min.js"></script>
    <script src="js/editor/js/plugins/font_family.min.js"></script>
    <script src="js/editor/js/plugins/font_size.min.js"></script>
    <script src="js/editor/js/plugins/block_styles.min.js"></script>
    <script src="js/editor/js/plugins/video.min.js"></script>
    <script src="js/date/js/laydate.js"></script>
    <script src="js/bootstrap/js/bootstrap.min.js"></script>
    <script src="js/bootstrap/css/bootstrap.min.css"></script>

    <script type="text/javascript" src="js/json2.js"></script>
    <script type="text/javascript" language="javascript"
            src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <!-- ECharts单文件引入 -->
    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script src="frame/bootstrap-table-zh-CN.js"></script>
    <script src="frame/bootstrap-table.js"></script>
    <link href="frame/bootstrap-table.css" rel="stylesheet">


    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="frame/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="frame/bootstrap/js/bootstrap.min.js">
    <script type="text/javascript">
        $(document).ready(function () {
            testRequestBody();
        });

        function testRequestBody() {
            var storage = window.localStorage;
            var user_id = localStorage.getItem("user_id");
            var password = localStorage.getItem("password");
            var subject = localStorage.getItem("subject");
            //$.ajax("${pageContext.request.contextPath}/item-manage/getSingleManage",	// 发送请求的URL字符串。
            $.ajax("/wwwww/findAllSingle.action",
                {
                    dataType: "json", // 预期服务器返回的数据类型。
                    type: "post", //  请求方式 POST或GET
                    contentType: "application/json", //  发送信息至服务器时的内容编码类型
                    // 发送到服务器的数据。
                    // data:JSON.stringify({user_id :user_id, password : password,subject:subject}),
                    data: JSON.stringify({}),
                    async: true, // 默认设置下，所有请求均为异步请求。如果设置为false，则发送同步请求
                    // 请求成功后的回调函数。
                    success: function (data) {

                        console.log(data);
                        $(function () {
                            //动态创建表格的方式，使用拼接html

                            //选择题信息
                            var htmlInfo = "";
                            var userSum = 0;
                            for (var i = 0; i < data.length; i++) {
                                // console.log(data[i].sex);
                                userSum++;
                                //if(data[i].sex){
                                htmlInfo += "<tr>";
                                htmlInfo += "<td>" + data[i].singleId + "</td>";
                                htmlInfo += "<td>" + data[i].content + "</td>";
                                htmlInfo += "<td>" + data[i].difficultyCoe + "</td>";
                                htmlInfo += "<td>" + data[i].a + "</td>";
                                htmlInfo += "<td>" + data[i].b + "</td>";
                                htmlInfo += "<td>" + data[i].c + "</td>";
                                htmlInfo += "<td>" + data[i].d + "</td>";
                                htmlInfo += "<td>" + data[i].chapter + "</td>";
                                htmlInfo += "<td>" + data[i].answer + "</td>";
                                /*
                                                        htmlInfo +=     "<td>" + "<a href='javascript:void(0);' onclick=addSingleFunction("+"'"+data[i].singleId+"','"+data[i].subject+"','"
                                                                        +data[i].content+"','"+data[i].a+"','"+data[i].b+"','"+data[i].c+"','"+data[i].d+"','"
                                                                           +data[i].difficultyCoe+"','"+data[i].answer+"','"+data[i].chapter+"','"
                                                                        +i+"'"+") >checkbox加入此题</a>"+ "</td>";
                                                        htmlInfo +=     "<td>" + "<a href='javascript:void(0);' onclick=deleteSingle("+"'"+data[i].singleId+"'"+",'"+i+"'"+") >删除此题</a>"+"</td>";
                                                         htmlInfo += "</tr>";*/
                                htmlInfo += "<td>" + "<a href='javascript:void(0);' onclick=addSingleFunction(" + "'" + data[i].singleId
                                    + "','" + data[i].subject + "','" + data[i].content.split(" ").join(" ")
                                    + "','" + data[i].a.split(" ").join(" ") + "','" + data[i].b.split(" ").join(" ")
                                    + "','" + data[i].c.split(" ").join(" ") + "','" + data[i].d.split(" ").join(" ")
                                    + "','" + data[i].difficultyCoe + "','" + data[i].answer.split(" ").join(" ")
                                    + "','" + data[i].chapter + "','" + i + "'" + ") >此题加入试卷</a>" + "</td>";
                                htmlInfo += "<td>" + "<a href='javascript:void(0);' onclick=deleteSingle(" + "'" + data[i].singleId + "'" + ",'" + i + "'" + ") >删除此题</a>" + "</td>";
                                htmlInfo += "</tr>";
                                // }
                            }
                            $("#infoData").html(htmlInfo);
                        });
                        <!--
                        -->
                    },
                    // 请求出错时调用的函数
                    error: function () {
                        //	   alert("数据发送失败");
                    }
                });

        }
    </script>
    <script>
        //Function Interface
        //function ----1.删除此题----
        function deleteSingle(singleId, i) {
            deleteSingleImp(singleId, i);
        }

        //function ----2.加入题库----
        function addSingleFunction(singleId, subject, content, a, b, c, d, difficultyCoe, answer, chapter, i) {
            single.fullName(singleId, subject, content, a, b, c, d, difficultyCoe, answer, chapter);
            $("#infoData").find("tr").eq(i).find("td").eq(9).html("已在试卷中");
        }
    </script>


</head>
<body>
<h1>选择题信息</h1>
<button type="button" class="btn btn-primary" onclick="submitTo()">选择题已选完</button>
<div class="alert"></div>
<div class="bs-docs-example">
    <div class="tabbable" style="margin-bottom: 8px;">
        <div class="tab-content"
             style="padding-bottom: 9px; border-bottom: 1px solid #ddd;">
            <table data-toggle="table" id="table">
                <thead>
                <tr>
                    <th>题号id</th>
                    <th>内容</th>
                    <th>难度</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                    <th>D</th>
                    <th>所属章节</th>
                    <th>答案</th>
                    <th>加入试卷</th>
                    <th>删除此题</th>
                </tr>
                </thead>
                <tbody id="infoData">
                </tbody>
            </table>


        </div>
    </div>
    <!-- /tabbable -->
</div>

</body>
<script>
    //function Implement
    var fflag = 0;

    //function ---1.删除此题---
    function deleteSingleImp(singleId, i) {
        var Single = "Single";
        $.ajax("/wwwww/delete.action",	// 发送请求的URL字符串。
            {
                dataType: "json", // 预期服务器返回的数据类型。
                type: "post", //  请求方式 POST或GET
                contentType: "application/json", //  发送信息至服务器时的内容编码类型
                // 发送到服务器的数据。
                data: JSON.stringify({"type": Single, "id": singleId}),
                async: true, // 默认设置下，所有请求均为异步请求。如果设置为false，则发送同步请求
                // 请求成功后的回调函数。
                success: function (data) {
                    console.log(data);
                    $(function () {
                        if (data == 1) {
                            var sum = i;
                            $('.alert').html('删除成功').addClass('alert-success').show().delay(1500).fadeOut();
                            $("#infoData").find("tr").eq(i).remove();
                            fflag = fflag + 1;
                        }
                        else {
                            alert("修改失败");
                        }
                    });
                },
                // 请求出错时调用的函数
                error: function () {
                    //	   alert("数据发送失败");
                }
            });
    }


</script>


<script>
    //缓存
    var addSingle = [];
    var tt = 0;
    var single = {
        type: "single",
        singleId: "",
        subject: "",
        content: "",
        A: "",
        B: "",
        C: "",
        D: "",
        difficultyCoe: "",
        answer: "",
        chapter: "",
        fullName: function (singleId, subject, content, A, B, C, D, difficultyCoe, answer, chapter) {
            this.singleId = singleId;
            this.subject = subject,
                this.content = content;
            this.A = A;
            this.B = B;
            this.C = C;
            this.D = D;
            this.difficultyCoe = difficultyCoe;
            this.answer = answer;
            this.chapter = chapter;
            var instead = {
                type: "single",
                singleId: "",
                subject: "",
                content: "",
                A: "",
                B: "",
                C: "",
                D: "",
                difficultyCoe: "",
                answer: "",
                chapter: "",
                fullName: function (singleId, subject, content, A, B, C, D, difficultyCoe, answer, chapter) {
                    this.singleId = singleId;
                    this.subject = subject,
                        this.content = content;
                    this.A = A;
                    this.B = B;
                    this.C = C;
                    this.D = D;
                    this.difficultyCoe = difficultyCoe;
                    this.answer = answer;
                    this.chapter = chapter;
                }
            }
            instead.fullName(singleId, subject, content, A, B, C, D, difficultyCoe, answer, chapter);
            addSingle.push(instead);
            return this.singleId + " " + this.content;
        }
    };

    function submitTo() {
        //存入
        var singleLocalStorage = JSON.stringify(addSingle);
        localStorage.setItem("single", singleLocalStorage);

        //读取
        var optionss = localStorage.getItem("single");
        console.log("   选择题的缓存:   ");
        console.log(JSON.parse(optionss));
    }

</script>
</html>
